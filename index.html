
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Di≈üli Bilgileri V31 - APK</title>
    <style>
        :root { --p: #007bff; --s: #28a745; --d: #dc3545; --bg: #f8f9fa; --folder-bg: #1a252f; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 80px; color: #333; }
        .box { background: white; padding: 12px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 12px; }
        
        .lbl-edit { font-size: 11px; font-weight: bold; color: #555; display: block; margin-bottom: 2px; border: none; background: transparent; width: 100%; cursor: text; padding: 0; }
        .lbl-edit:focus { outline: none; border-bottom: 1px solid var(--p); color: var(--p); }
        .static-lbl { font-size: 11px; font-weight: bold; color: #888; display: block; margin-bottom: 2px; }

        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; background: #fff; }
        input:focus { border-color: var(--p); outline: none; }
        
        .row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 5px; }
        .col { flex: 1; min-width: 80px; }
        .w-group { display: flex; align-items: center; gap: 4px; margin-bottom: 4px; }
        .w-param { width: 45px !important; text-align: center; background: #f1f1f1; font-weight: bold; margin-bottom:0 !important; }
        .w-val { margin-bottom: 0 !important; }
        .btn-add-w { background: #eee; border: 1px solid #ccc; border-radius: 4px; padding: 2px 8px; font-size: 12px; cursor: pointer; margin-bottom: 5px; width: auto; color: #333; display: inline-block; }
        
        button { width: 100%; border: none; padding: 15px; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn-save { background: var(--s); margin-top: 10px; box-shadow: 0 4px 0 #218838; }
        .btn-save:active { transform: translateY(3px); box-shadow: none; }
        .btn-backup { background: #5a6268; font-size: 12px; padding: 10px; margin-top: 10px; }
        
        .folder-sub-header { 
            background: var(--folder-bg); color: #fff; padding: 15px; font-size: 16px; font-weight: bold; 
            margin-top: 10px; border-radius: 10px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
        }
        .folder-content { display: none; padding: 5px 0 15px 10px; border-left: 4px solid var(--folder-bg); margin-bottom: 10px; }
        .btn-add-folder { background: #fff; color: var(--folder-bg); border: none; border-radius: 6px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; }

        .item-card { background: white; border-radius: 12px; padding: 15px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 6px solid var(--p); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .type-header { background: #444; color: white; padding: 10px; border-radius: 8px; margin-top: 20px; font-size: 14px; text-align: center; font-weight: bold; }

        #page-detail { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8f9fa; z-index: 1000; overflow-y: auto; padding: 15px; box-sizing: border-box; }
        .info-grid { display: grid; gap: 8px; }
        .info-item { background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #eee; }

        .photo-section { margin-top: 15px; border-top: 1px solid #ddd; padding-top: 10px; }
        .photo-grid { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .photo-wrapper { position: relative; width: 80px; height: 80px; }
        .photo-preview { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }
        .photo-remove { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .btn-photo { background: #6c757d; font-size: 14px; padding: 10px; margin-bottom: 10px; }
        
        @media screen and (min-width: 992px) {
            body { max-width: 1100px; margin: 0 auto; padding: 30px; font-size: 20px; }
            .box { padding: 40px; }
            input, select, textarea { font-size: 20px; padding: 18px; }
            .lbl-edit, .static-lbl { font-size: 16px; }
            .grid-val { font-size: 26px !important; font-weight: bold; }
        }
    </style>
</head>
<body>

<div id="page-main">
    <div class="box">
        <h3 id="lbl-title" style="margin:0 0 20px 0; text-align:center; color:var(--p)">‚öôÔ∏è Dƒ∞≈ûLƒ∞ Bƒ∞LGƒ∞ Sƒ∞STEMƒ∞ V31</h3>
        
        <input type="hidden" id="inp-id">
        
        <div class="row">
            <div class="col" style="flex: 1.5;"><span class="static-lbl">Kategori</span>
                <select id="inp-tur" style="background: #fff9c4; font-weight: bold;" onchange="toggleMDKod()">
                    <option value="Seri √úretim">‚öôÔ∏è Seri √úretim</option>
                    <option value="Piyasa ƒ∞≈üi">üõ†Ô∏è Piyasa ƒ∞≈üi</option>
                </select>
            </div>
            <div class="col" style="flex: 2;"><span class="static-lbl">Klas√∂r / Firma</span>
                <input type="text" id="inp-k" placeholder="√ñrn: ABC Makine">
            </div>
        </div>

        <div class="row">
            <div class="col"><input class="lbl-edit" id="l-ds" value="Di≈ü Sayƒ±sƒ±" onchange="saveLbl(this)"><input type="text" id="inp-ds" placeholder="Z"></div>
            <div class="col"><input class="lbl-edit" id="l-mod" value="Mod√ºl" onchange="saveLbl(this)"><input type="text" id="inp-mod" placeholder="Mn"></div>
            <div class="col"><input class="lbl-edit" id="l-alfa" value="Alfa" onchange="saveLbl(this)"><input type="text" id="inp-alfa" placeholder="Œ±"></div>
            <div class="col"><input class="lbl-edit" id="l-beta" value="Beta" onchange="saveLbl(this)"><input type="text" id="inp-beta" placeholder="Œ≤"></div>
            <div class="col"><input class="lbl-edit" id="l-yon" value="Y√∂n" onchange="saveLbl(this)"><input type="text" id="inp-yon" placeholder="R/L"></div>
        </div>

        <div class="row">
            <div id="md-container" class="col" style="flex: 1;"><input class="lbl-edit" id="l-md" value="MD Kodu" onchange="saveLbl(this)"><input type="text" id="inp-md"></div>
            <div class="col" style="flex: 2;"><input class="lbl-edit" id="l-u" value="√úr√ºn / Par√ßa Adƒ±" onchange="saveLbl(this)"><input type="text" id="inp-u"></div>
        </div>

        <div class="row">
            <div class="col"><input class="lbl-edit" id="l-odu" value="Orj Di≈ü √úst√º" onchange="saveLbl(this)"><input type="text" id="inp-odu"></div>
            <div class="col"><input class="lbl-edit" id="l-adu" value="Azd Di≈ü √úst√º" onchange="saveLbl(this)"><input type="text" id="inp-adu"></div>
            <div class="col"><input class="lbl-edit" id="l-rdu" value="Raspa Di≈ü √úst√º" onchange="saveLbl(this)"><input type="text" id="inp-rdu"></div>
        </div>

        <div class="row">
            <div class="col"><input class="lbl-edit" id="l-odd" value="Orj Di≈ü Dibi" onchange="saveLbl(this)"><input type="text" id="inp-odd"></div>
            <div class="col"><input class="lbl-edit" id="l-add" value="Azd Di≈ü Dibi" onchange="saveLbl(this)"><input type="text" id="inp-add"></div>
            <div class="col"><input class="lbl-edit" id="l-rdd" value="Raspa Di≈ü Dibi" onchange="saveLbl(this)"><input type="text" id="inp-rdd"></div>
        </div>

        <div class="row">
            <div class="col">
                <input class="lbl-edit" id="l-ow" value="Orj W" onchange="saveLbl(this)">
                <div id="container-ow"></div>
                <div class="btn-add-w" onclick="addWRow('ow')">+ W Ekle</div>
            </div>
            <div class="col">
                <input class="lbl-edit" id="l-aw" value="Azd W" onchange="saveLbl(this)">
                <div id="container-aw"></div>
                <div class="btn-add-w" onclick="addWRow('aw')">+ W Ekle</div>
            </div>
            <div class="col">
                <input class="lbl-edit" id="l-rw" value="Raspa W" onchange="saveLbl(this)">
                <div id="container-rw"></div>
                <div class="btn-add-w" onclick="addWRow('rw')">+ W Ekle</div>
            </div>
        </div>

        <div class="row">
            <div class="col"><input class="lbl-edit" id="l-ot" value="Orj Thick" onchange="saveLbl(this)"><input type="text" id="inp-ot"></div>
            <div class="col"><input class="lbl-edit" id="l-at" value="Azd Thick" onchange="saveLbl(this)"><input type="text" id="inp-at"></div>
            <div class="col"><input class="lbl-edit" id="l-rt" value="Raspa Thick" onchange="saveLbl(this)"><input type="text" id="inp-rt"></div>
        </div>

        <div class="row">
            <div class="col"><input class="lbl-edit" id="l-raa" value="Raspa Ayar A√ßƒ±sƒ±" onchange="saveLbl(this)"><input type="text" id="inp-raa"></div>
        </div>

        <textarea id="inp-a" rows="3" placeholder="Ek Notlar..."></textarea>

        <div class="photo-section">
            <span class="static-lbl">Fotoƒüraflar</span>
            <button class="btn-photo" onclick="document.getElementById('inp-file').click()">üì∏ FOTOƒûRAF √áEK / EKLE</button>
            <input type="file" id="inp-file" accept="image/*" multiple style="display:none" onchange="handleFiles(this)">
            <div id="photo-preview-container" class="photo-grid"></div>
        </div>
        
        <button class="btn-save" id="btn-submit" onclick="saveItem()">VERƒ∞LERƒ∞ KAYDET</button>

        <div style="display:flex; gap:10px;">
            <button class="btn-backup" onclick="exportData()">üì• YEDEK AL</button>
            <button class="btn-backup" onclick="document.getElementById('importFile').click()">üì§ Y√úKLE</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(event)">
        </div>
    </div>

    <div class="box" style="position:sticky; top:0; z-index:100;">
        <input type="text" id="inp-search" onkeyup="renderList()" placeholder="üîç Par√ßa veya Kod Ara..." style="margin:0;">
    </div>

    <div id="list-container"></div>
</div>

<div id="page-detail">
    <button onclick="showMain()" style="background:#333; margin-bottom:15px;">‚¨ÖÔ∏è Lƒ∞STEYE D√ñN</button>
    <div id="detail-content" class="box"></div>
    <div style="display:flex; gap:10px; margin-top:15px;">
        <button onclick="editItem()" style="background:#ffc107; color:#000;">‚úèÔ∏è D√úZENLE</button>
        <button onclick="deleteItem()" style="background:var(--d);">üóëÔ∏è KAYDI Sƒ∞L</button>
    </div>
</div>

<script>
    let db;
    let currentPhotos = [];
    const request = indexedDB.open("AtolyeDB_Disli_V21", 2);

    request.onsuccess = (e) => { db = e.target.result; renderList(); toggleMDKod(); loadLabels(); resetWContainers(); };
    request.onupgradeneeded = (e) => { let dbRef = e.target.result; if (!dbRef.objectStoreNames.contains("disliler")) { dbRef.createObjectStore("disliler", { keyPath: "id" }); } };

    let detailId = null;

    function saveLbl(el) {
        let labels = JSON.parse(localStorage.getItem('customLabels')) || {};
        labels[el.id] = el.value;
        localStorage.setItem('customLabels', JSON.stringify(labels));
    }

    function loadLabels() {
        let labels = JSON.parse(localStorage.getItem('customLabels'));
        if (labels) { for (let id in labels) { const el = document.getElementById(id); if(el) el.value = labels[id]; } }
    }

    function resetWContainers() {
        ['ow', 'aw', 'rw'].forEach(type => {
            document.getElementById('container-' + type).innerHTML = '';
            addWRow(type);
        });
    }

    function addWRow(type, p = '', v = '') {
        const cont = document.getElementById('container-' + type);
        const div = document.createElement('div');
        div.className = 'w-group';
        div.innerHTML = `<input type="text" class="w-param ${type}-p" placeholder="k" value="${p}"><input type="text" class="w-val ${type}-v" value="${v}">`;
        cont.appendChild(div);
    }

    function getWValues(type) {
        let params = document.querySelectorAll(`.${type}-p`);
        let values = document.querySelectorAll(`.${type}-v`);
        let data = [];
        params.forEach((p, i) => { if(p.value || values[i].value) data.push({p: p.value, v: values[i].value}); });
        return data;
    }

    async function handleFiles(input) {
        for (let file of input.files) {
            const compressed = await compressImage(file);
            currentPhotos.push(compressed);
        }
        renderPhotoPreviews();
        input.value = "";
    }

    function compressImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width, height = img.height, max = 1000;
                    if (width > height) { if (width > max) { height *= max / width; width = max; } }
                    else { if (height > max) { width *= max / height; height = max; } }
                    canvas.width = width; canvas.height = height;
                    canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                    canvas.toBlob((blob) => resolve(blob), 'image/jpeg', 0.7);
                };
            };
        });
    }

    function renderPhotoPreviews() {
        const cont = document.getElementById('photo-preview-container');
        cont.innerHTML = '';
        currentPhotos.forEach((blob, index) => {
            const url = URL.createObjectURL(blob);
            const div = document.createElement('div');
            div.className = 'photo-wrapper';
            div.innerHTML = `<img src="${url}" class="photo-preview"><div class="photo-remove" onclick="removePhoto(${index})">√ó</div>`;
            cont.appendChild(div);
        });
    }

    function removePhoto(idx) { currentPhotos.splice(idx, 1); renderPhotoPreviews(); }

    function toggleMDKod() {
        const tur = document.getElementById('inp-tur').value;
        document.getElementById('md-container').style.display = (tur === "Piyasa ƒ∞≈üi") ? 'none' : 'block';
    }

    function saveItem() {
        const u = document.getElementById('inp-u').value.trim();
        if(!u) return alert("Par√ßa Adƒ± Bo≈ü Olamaz!");
        const currentLabels = {};
        document.querySelectorAll('.lbl-edit').forEach(lbl => { currentLabels[lbl.id] = lbl.value; });
        const item = {
            id: document.getElementById('inp-id').value || Date.now().toString(),
            u: u, tur: document.getElementById('inp-tur').value, k: document.getElementById('inp-k').value || "Genel",
            md: document.getElementById('inp-md').value, ds: document.getElementById('inp-ds').value, mod: document.getElementById('inp-mod').value,
            alfa: document.getElementById('inp-alfa').value, beta: document.getElementById('inp-beta').value, yon: document.getElementById('inp-yon').value,
            odu: document.getElementById('inp-odu').value, adu: document.getElementById('inp-adu').value, rdu: document.getElementById('inp-rdu').value,
            odd: document.getElementById('inp-odd').value, add: document.getElementById('inp-add').value, rdd: document.getElementById('inp-rdd').value,
            ws_orj: getWValues('ow'), ws_azd: getWValues('aw'), ws_raspa: getWValues('rw'),
            ot: document.getElementById('inp-ot').value, at: document.getElementById('inp-at').value, rt: document.getElementById('inp-rt').value,
            raa: document.getElementById('inp-raa').value, a: document.getElementById('inp-a').value,
            photos: currentPhotos, savedLabels: currentLabels, tarih: new Date().getTime()
        };
        const tx = db.transaction(["disliler"], "readwrite");
        tx.objectStore("disliler").put(item);
        tx.oncomplete = () => { alert("Kaydedildi!"); location.reload(); };
    }

    function renderList() {
        if(!db) return;
        const container = document.getElementById('list-container');
        const search = document.getElementById('inp-search').value.toLowerCase();
        db.transaction("disliler").objectStore("disliler").getAll().onsuccess = (e) => {
            let list = e.target.result.filter(i => `${i.u} ${i.md} ${i.k}`.toLowerCase().includes(search));
            list.sort((a,b) => b.tarih - a.tarih);
            container.innerHTML = "";
            ["Seri √úretim", "Piyasa ƒ∞≈üi"].forEach((type, tIdx) => {
                const typeItems = list.filter(x => x.tur === type);
                if(typeItems.length > 0) {
                    const th = document.createElement('div'); th.className = 'type-header'; th.innerText = type.toUpperCase(); container.appendChild(th);
                    const folders = [...new Set(typeItems.map(x => x.k))];
                    folders.forEach((f, fIdx) => {
                        const fId = "folder_" + tIdx + "_" + fIdx;
                        const items = typeItems.filter(x => x.k === f);
                        const fHead = document.createElement('div'); fHead.className = 'folder-sub-header'; fHead.onclick = () => toggleFolder(fId);
                        fHead.innerHTML = `<span><span id="icon-${fId}">‚ñ∏</span> üìÅ ${f} (${items.length})</span> <button class="btn-add-folder" onclick="fillFolder('${f.replace(/'/g, "\\'")}', '${type}', event)">+</button>`;
                        container.appendChild(fHead);
                        const fContent = document.createElement('div'); fContent.id = 'content-' + fId; fContent.className = 'folder-content';
                        items.forEach(item => {
                            const card = document.createElement('div'); card.className = 'item-card';
                            const L = item.savedLabels || {};
                            // Dƒ∞NAMƒ∞K ETƒ∞KET ƒ∞Sƒ∞MLERƒ∞ (Mn -> Dp gibi)
                            const lblMod = L['l-mod'] || 'Mn';
                            const lblAlfa = L['l-alfa'] || 'Œ±';
                            const lblBeta = L['l-beta'] || 'Œ≤';

                            card.innerHTML = `
                                <div>
                                    <small style="color:var(--p)">${item.md || '---'}</small><br>
                                    <b>${item.u}</b><br>
                                    <small>Z: ${item.ds} | ${lblMod}: ${item.mod} | ${lblAlfa}: ${item.alfa || '-'} | ${lblBeta}: ${item.beta || '-'}</small>
                                </div>
                                <div>üëâ</div>`;
                            card.onclick = () => openDetail(item);
                            fContent.appendChild(card);
                        });
                        container.appendChild(fContent);
                    });
                }
            });
        };
    }

    function openDetail(item) {
        detailId = item.id;
        const L = item.savedLabels || {};
        const h_orj = (L['l-odu'] || "ORJ").split(' ')[0].toUpperCase();
        const h_azd = (L['l-adu'] || "AZD").split(' ')[0].toUpperCase();
        const h_rsp = (L['l-rdu'] || "RASPA").split(' ')[0].toUpperCase();
        let maxW = Math.max((item.ws_orj?.length||0), (item.ws_azd?.length||0), (item.ws_raspa?.length||0), 1);
        let wRowsHtml = '';
        for(let i=0; i<maxW; i++) {
            let o = item.ws_orj?.[i] || {p:'', v:''}, a = item.ws_azd?.[i] || {p:'', v:''}, r = item.ws_raspa?.[i] || {p:'', v:''};
            wRowsHtml += `<div style="background:#fff; padding:5px; font-size:11px;"><b>W(${o.p}) / (${a.p})</b></div><div class="grid-val" style="text-align:center;">${o.v||'-'}</div><div class="grid-val" style="text-align:center;">${a.v||'-'}</div><div class="grid-val" style="text-align:center;">${r.v||'-'}</div>`;
        }
        let photoHtml = '';
        if(item.photos && item.photos.length > 0) {
            photoHtml = '<div class="photo-grid" style="margin-top:20px;">' + item.photos.map(blob => `<img src="${URL.createObjectURL(blob)}" style="width:100%; border-radius:10px; margin-bottom:10px; border:2px solid #ddd;">`).join('') + '</div>';
        }
        document.getElementById('detail-content').innerHTML = `
            <div style="font-size:14px; color:#666; font-weight:bold;">${item.tur} / ${item.k}</div>
            <h2 style="color:var(--p); margin:10px 0;">${item.u}</h2>
            <div class="info-grid" style="grid-template-columns: 1fr 1fr; margin-bottom:20px;">
                <div class="info-item"><b>${L['l-md'] || 'Kod'}:</b> ${item.md || '-'}</div>
                <div class="info-item"><b>${L['l-ds'] || 'Z'}:</b> ${item.ds}</div>
                <div class="info-item"><b>${L['l-mod'] || 'Mn'}:</b> ${item.mod}</div>
                <div class="info-item"><b>${L['l-alfa'] || 'Alfa'}:</b> ${item.alfa}</div>
                <div class="info-item"><b>${L['l-beta'] || 'Beta'}:</b> ${item.beta}</div>
                <div class="info-item"><b>${L['l-yon'] || 'Y√∂n'}:</b> ${item.yon}</div>
            </div>
            <div style="background:var(--d); color:white; padding:8px; font-weight:bold; border-radius:5px; text-align:center;">√ñL√á√ú TABLOSU</div>
            <div class="info-grid" style="background:#eee; padding:5px; gap:2px; margin-top:5px; border-radius:5px; grid-template-columns: 1.2fr 1fr 1fr 1fr;">
                <div style="background:#ddd; padding:5px;"></div><div style="font-weight:bold; background:#ddd; padding:5px; text-align:center;">${h_orj}</div><div style="font-weight:bold; background:#ddd; padding:5px; text-align:center;">${h_azd}</div><div style="font-weight:bold; background:#ddd; padding:5px; text-align:center;">${h_rsp}</div>
                <div style="background:#fff; padding:5px; font-size:13px;"><b>Di≈ü √úst√º</b></div><div class="grid-val" style="text-align:center;">${item.odu||'-'}</div><div class="grid-val" style="text-align:center;">${item.adu||'-'}</div><div class="grid-val" style="text-align:center;">${item.rdu||'-'}</div>
                <div style="background:#fff; padding:5px; font-size:13px;"><b>Di≈ü Dibi</b></div><div class="grid-val" style="text-align:center;">${item.odd||'-'}</div><div class="grid-val" style="text-align:center;">${item.add||'-'}</div><div class="grid-val" style="text-align:center;">${item.rdd||'-'}</div>
                ${wRowsHtml}
                <div style="background:#fff; padding:5px; font-size:13px;"><b>Thick</b></div><div class="grid-val" style="text-align:center;">${item.ot||'-'}</div><div class="grid-val" style="text-align:center;">${item.at||'-'}</div><div class="grid-val" style="text-align:center;">${item.rt||'-'}</div>
                <div style="grid-column: span 1; background:#fff3cd; padding:5px; font-size:13px;"><b>A√ßƒ±</b></div><div style="grid-column: span 3; background:#fff3cd; font-weight:bold; text-align:center; padding:5px;">${item.raa||'-'}</div>
            </div>
            <div style="margin-top:20px; padding:15px; background:#f0f0f0; border-radius:10px; border-left:8px solid #ccc;"><b>Notlar:</b><br>${item.a || '-'}</div>
            ${photoHtml}
        `;
        document.getElementById('page-main').style.display = 'none';
        document.getElementById('page-detail').style.display = 'block';
    }

    function editItem() {
        db.transaction("disliler").objectStore("disliler").get(detailId).onsuccess = (e) => {
            const i = e.target.result; showMain();
            if(i.savedLabels) { localStorage.setItem('customLabels', JSON.stringify(i.savedLabels)); loadLabels(); }
            document.getElementById('inp-id').value = i.id; document.getElementById('inp-u').value = i.u; 
            document.getElementById('inp-tur').value = i.tur; document.getElementById('inp-k').value = i.k;
            document.getElementById('inp-md').value = i.md || ""; document.getElementById('inp-ds').value = i.ds; 
            document.getElementById('inp-mod').value = i.mod; document.getElementById('inp-alfa').value = i.alfa; 
            document.getElementById('inp-beta').value = i.beta; document.getElementById('inp-yon').value = i.yon;
            document.getElementById('inp-odu').value = i.odu; document.getElementById('inp-adu').value = i.adu; 
            document.getElementById('inp-rdu').value = i.rdu; document.getElementById('inp-odd').value = i.odd; 
            document.getElementById('inp-add').value = i.add; document.getElementById('inp-rdd').value = i.rdd;
            document.getElementById('inp-ot').value = i.ot; document.getElementById('inp-at').value = i.at; 
            document.getElementById('inp-rt').value = i.rt; document.getElementById('inp-raa').value = i.raa; 
            document.getElementById('inp-a').value = i.a;
            ['ow', 'aw', 'rw'].forEach(type => {
                const cont = document.getElementById('container-' + type); cont.innerHTML = '';
                const data = i['ws_' + (type==='ow'?'orj':(type==='aw'?'azd':'raspa'))] || [];
                if(data.length === 0) addWRow(type); else data.forEach(d => addWRow(type, d.p, d.v));
            });
            currentPhotos = i.photos || []; renderPhotoPreviews();
            toggleMDKod(); document.getElementById('btn-submit').innerText = "KAYDI G√úNCELLE"; window.scrollTo(0,0);
        };
    }

    function toggleFolder(fId) { const cont = document.getElementById('content-' + fId); const ico = document.getElementById('icon-' + fId); const isOpen = cont.style.display === "block"; cont.style.display = isOpen ? "none" : "block"; ico.innerText = isOpen ? "‚ñ∏" : "‚ñæ"; }
    function fillFolder(name, type, e) { e.stopPropagation(); document.getElementById('inp-k').value = name; document.getElementById('inp-tur').value = type; toggleMDKod(); window.scrollTo({ top: 0, behavior: 'smooth' }); }
    function deleteItem() { if(confirm("Kayƒ±t silinsin mi?")) { db.transaction(["disliler"], "readwrite").objectStore("disliler").delete(detailId).oncomplete = () => location.reload(); } }
    function showMain() { document.getElementById('page-detail').style.display = 'none'; document.getElementById('page-main').style.display = 'block'; }
    function exportData() { db.transaction("disliler").objectStore("disliler").getAll().onsuccess = async (e) => { const list = e.target.result; for(let item of list) { if(item.photos) { const base64Photos = []; for(let b of item.photos) { base64Photos.push(await new Promise(r => { const rd = new FileReader(); rd.onload = () => r(rd.result); rd.readAsDataURL(b); })); } item.photos = base64Photos; } } const blob = new Blob([JSON.stringify(list)], {type: "application/json"}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "Disli_Yedek_V31.json"; a.click(); }; }
    function importData(e) { const file = e.target.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = async (ev) => { try { const data = JSON.parse(ev.target.result); const tx = db.transaction(["disliler"], "readwrite"); for(let item of data) { if(item.photos && typeof item.photos[0] === 'string') { const blobPhotos = []; for(let s of item.photos) { const res = await fetch(s); blobPhotos.push(await res.blob()); } item.photos = blobPhotos; } tx.objectStore("disliler").put(item); } tx.oncomplete = () => { alert("Y√ºklendi!"); location.reload(); }; } catch(h) { alert("Hata!"); } }; reader.readAsText(file); }
</script>
</body>
</html>
